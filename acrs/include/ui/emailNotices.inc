<?php
/*  emailNotices.inc, acrs/include/ui, dclo, 10/23/2010
 *  functions to send email notices to contest personnel
 *
 *  Changes:
 *    10/23/2010 jim_ward       Use ADMIN_EMAIL, REGISTRATION_URL.  Also, small punctuation fix.
 *    07/04/2007 dlco           original coding.
 */

require_once ('useful.inc');
require_once ('dbConfig.inc');

function automatedMessage($contestName)
{
    $message = "\n" . 'This is an automated response generated by the ';
    $message .= $contestName . ' registration system.';
    return $message;
}

/**
Send a welcome email
*/
function sendAccountEstablishedEmail($registrant, $newPwd)
{
    $givenName = $registrant['givenName'];
    $familyName = $registrant['familyName'];
    $email = $registrant['email'];
    $accountName = $registrant['accountName'];
    $subject = "Welcome to the contest registration system.";
    $mailContent = 'Welcome, ' . $givenName . ' ' . $familyName . ', to the contest registration system. ';
    $mailContent .= "Here are your login credentials.\n";
    $mailContent .= "Account name: " . $accountName . "\n";
    $mailContent .= "Password: " . $newPwd . "\n";
    $mailContent .= "Log-in to change your password right away as email is not secure.\n";
    $mailContent .= "\nUse the following link to log-in and change your password:\n\n";
    $mailContent .= REGISTRATION_URL . "login.php?url=changePWD.php&uid=" . urlencode($accountName);
    $mailContent .= "&pwd=" . urlencode($newPwd);
    $mailContent .= "\n\nIf you have difficulty, please write to the web site administrator: ";
    $mailContent .= "mailto:" . ADMIN_EMAIL . "?subject=" . urlencode("account registration");
    $mailContent .= " or simply reply to this note.\n";
    $mailContent .= automatedMessage('contest');
    $fromAddress = "From: " . ADMIN_EMAIL . "\r\n";
    do_email($email, $subject, $mailContent, $fromAddress);
}

/**
Send an email on password reset
*/
function sendAccountResetEmail($registrant, $newPwd)
{
    $givenName = $registrant['givenName'];
    $familyName = $registrant['familyName'];
    $email = $registrant['email'];
    $accountName = $registrant['accountName'];
    $subject = "Your contest registration system account.";
    $mailContent = $givenName . ' ' . $familyName .
    ":\n\nHere are your new login credentials" .
    " for the contest registration system.\n";
    $mailContent .= "Account name: " . $accountName . "\n";
    $mailContent .= "Password: " . $newPwd . "\n";
    $mailContent .= "Log-in to change your password right away as email is not secure.\n";
    $mailContent .= "\nUse the following link to log-in and change your password:\n";
    $mailContent .= "\n" . REGISTRATION_URL . "login.php?url=changePWD.php&uid=" . urlencode($accountName);
    $mailContent .= "&pwd=" . urlencode($newPwd) . "\n";
    $mailContent .= "\nIf you have difficulty, please write to the web site administrator: ";
    $mailContent .= "mailto:" . ADMIN_EMAIL . "?subject=" . urlencode("contest registration password reset");
    $mailContent .= " or simply reply to this note.\n";
    $mailContent .= automatedMessage('contest');
    $fromAddress = "From: " . ADMIN_EMAIL . "\r\n";
    do_email($email, $subject, $mailContent, $fromAddress);
}

/**
Send an email about the password change
*/
function sendPasswordChangeEmail($email, $name, $accountName)
{
    $subject = "Contest registration system password changed.";
    $mailContent = $name . ": \n";
    $mailContent .= "The contest registration system has processed a password" .
    " change request for your account, " . $accountName . ".\n";
    $mailContent .= "\nIf you did not change your password please write to the member administrator:\n\n";
    $mailContent .= "mailto:" . ADMIN_EMAIL . "?subject=" . urlencode("password compromised") . "\n";
    $mailContent .= "\nright away, or simply reply to this note.\n";
    $fromAddress = "From: " . ADMIN_EMAIL . "\r\n";
    do_email($email, $subject, $mailContent, $fromAddress);
}

/**
Email acknowledgement of change to data
*/
function sendUpdateEmail($email, $registrant)
{
    $name = $_SESSION['ctst_name'];
    $subject = $name . " registration information updated.";
    $mailContent = $registrant['givenName'] . ' ' . $registrant['familyName'];
    $mailContent .= ":\n\n";
    $mailContent .= "Your information for the " . $name . " has been updated.\n";
    $mailContent .= "\nIf you did not edit your registration information, " .
    "please write to the administrator:\n";
    $mailContent .= "mailto:" . ADMIN_EMAIL . "?subject=account%20compromised\n";
    $mailContent .= "\nright away, or simply reply to this note.\n";
    $mailContent .= automatedMessage($name);
    $headers = "From: " . ADMIN_EMAIL . "\r\n";
    do_email($email, $subject, $mailContent, $headers);
}

/**
Email votes for judge selection
*/
function sendVotesEmail($registrant, $jlist)
{
    $contest = $_SESSION['contest'];
    $name = $_SESSION['ctst_name'];
    $subject = $name . " vote for judges.";
    $mailContent = $registrant['givenName'] . ' ' . $registrant['familyName'] .
    ' IAC member number ' . $registrant['iacID'] .
    ' voted as follows for judges at the ' . $name . "\n\n" . $jlist . "\n\n";
    $mailContent .= automatedMessage($name);
    $headers = "From: " . ADMIN_EMAIL . "\r\n";
    $headers .= "CC: " . $registrant['email'] . "\r\n";
    do_email($contest['voteEmail'], $subject, $mailContent, $headers);
}

/**
 * Email change to practice slot reservation
 */
function sendPracticeReservationEmail($registrant, $slot)
{
    $name = $_SESSION['ctst_name'];
    $subject = $name . " practice slot.";
    $mailContent = $registrant['givenName'] . ' ' . $registrant['familyName'] .
    " has practice slot(s):\n\n" . $slot . "\n\nat the " . $name . ".\n\n";
    $mailContent .= automatedMessage($name);
    $headers = "From: " . ADMIN_EMAIL . "\r\n";
    do_email($registrant['email'], $subject, $mailContent, $headers);
}

/**
 * Email paid notice
 */
function sendPaidEmail($registrant)
{
    $name = $_SESSION['ctst_name'];
    $subject = $name . " registration payment.";
    $mailContent = $registrant['givenName'] . ' ' . $registrant['familyName'] .
    ', the ' . $name . ' has your payment(s) totalling ' . $registrant['paidAmt'] .
    ".\n\n";
    $mailContent .= automatedMessage($name);
    $headers = "From: " . ADMIN_EMAIL . "\r\n";
    do_email($registrant['email'], $subject, $mailContent, $headers);
}

/*
   Copyright 2008 International Aerobatic Club, Inc.

   Licensed under the Apache License, Version 2.0 (the "License");
   you may not use this file except in compliance with the License.
   You may obtain a copy of the License at

       http://www.apache.org/licenses/LICENSE-2.0

   Unless required by applicable law or agreed to in writing, software
   distributed under the License is distributed on an "AS IS" BASIS,
   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   See the License for the specific language governing permissions and
   limitations under the License.
*/
?>
